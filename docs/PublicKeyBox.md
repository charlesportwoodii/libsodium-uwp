# Public Key Cryptography

Public key boxes allow an individual (Alice) to send an authenticated message to another individual (Bob) using only the public key of the recipient.

Using Bob's public key, Alice can send an encrypted message to Bob. Upon recieving the message, Bob can verify the message was not tampered with during transit, and decrypt the message. Using the same system, Bob can send a new message to Alice.

Public key boxes require only the secret key of the sender, the public key of the recipient, the message, and a nonce. The nonce should never be reused with a given secret and public key pair, and is not confidential. `Sodium.Utilities.Incriment` can be used to incriment the nonce so new nonces do not need to be generated.

Public key boxes provided mutal authentication.

## Generate nonce

__Namespace:__ _Sodium.PublicKeyBox_

```C#
public static byte[] Sodium.PublicKeyBox.GenerateNonce()
```

This method returns a 24 byte nonce.

## Generate KeyPair

__Namespace:__ _Sodium.PublicKeyBox_

```C#
public static KeyPair Sodium.PublicKeyBox.GenerateKeyPair()
public static KeyPair Sodium.PublicKeyBox.GenerateKeyPair(byte[] privateKey)
```

This method generates a new `KeyPair`. If a 32 byte `privateKey` is provided, this method will return the `KeyPair` (both public and secret components).

_If a new `KeyPair` is generated, this method will use `crypto_box_keypair` to generate the key pair. If a `privateKey` is provided. `Sodium.ScalarMult.Base` will be used to extract the public component from the `privateKey`.

# Combined mode

## Example
```C#
var message = System.Text.Encoding.UTF8.GetBytes("My secret message");
var alice = PublicKeyBox.GenerateKeyPair();
var bob = PublicKeyBox.GenerateKeyPair();

var nonce = PublicKeyBox.GenerateNonce();

// Alice encrypts a message for Bob
var encrypted = PublicKeyBox.Create(message, nonce, alice.Secret, bob.Public);

// Bob decrypts the message
var decrypted = PublicKeyBox.Open(encrypted, nonce, bob.Secret, alice.Public);
```

## Encrypt

__Namespace:__ _Sodium.PublicKeyBox_

```C#
public static byte[] Sodium.PublicKeyBox.Create(string message, byte[] nonce, byte[] secretKey, byte[] publicKey)
public static byte[] Sodium.PublicKeyBox.Create(byte[] message, byte[] nonce, byte[] secretKey, byte[] publicKey)
```

This method is used to encrypt a given message using a 24 byte `nonce`, a 32 byte `secretKey` belonging to the sender, and a 32 byte `publicKey` belonging to the recipient.

_This method internally uses `crypto_box_easy`._

## Decrypt

__Namespace:__ _Sodium.PublicKeyBox_

```C#
public static byte[] Sodium.PublicKeyBox.Open(byte[] cipherText, byte[] nonce, byte[] secretKey, byte[] publicKey)
```

This method is used to decrypt a `cipherText` generated by `Sodium.PublicKeyBox.Create` using a 24 byte `nonce`, the 32 byte `secretKey` belonging to the recipient, and the 32 byte `publicKey` belonging to the sender.

_This method internally uses `crypto_box_open_easy`._

# Detached mode

Detached variants of the functions above are also available. Detached boxes are represented by the following object:

```C#
public DetachedBox(byte[] cipher, byte[] mac)
{
  Cipher = cipher;
  Mac = mac;
}
```

## Example

```C#
var alice = PublicKeyBox.GenerateKeyPair();
var bob = PublicKeyBox.GenerateKeyPair();
var nonce = PublicKeyBox.GenerateNonce();
String message = "Hello, World!";

var encrypted = PublicKeyBox.CreateDetached(message, nonce, bob.Secret, alice.Public);
var decrypted = PublicKeyBox.OpenDetached(encrypted, nonce, alice.Secret, bob.Public);
```

## Encrypt

__Namespace:__ _Sodium.PublicKeyBox_

```C#
public static DetachedBox Sodium.PublicKeyBox.CreateDetached(byte[] message, byte[] nonce, byte[] secretKey, byte[] publicKey)
public static DetachedBox Sodium.PublicKeyBox.CreateDetached(String message, byte[] nonce, byte[] secretKey, byte[] publicKey)
```

Public key boxes can also be created in detached mode. `CreateDetached` encrypts a given `message` with the recipients 32 byte `publicKey`, the senders 32 byte `secretKey`, and a 24 byte `nonce`.

This method will return a `DetachedBox` if successful, or an exception otherwise.

_This method internally uses `crypto_box_detached`._

## Decrypt

__Namespace:__ _Sodium.PublicKeyBox_

```C#
public static byte[] OpenDetached(byte[] cipherText, byte[] mac, byte[] nonce, byte[] secretKey, byte[] publicKey)
public static byte[] OpenDetached(String cipherText, byte[] mac, byte[] nonce, byte[] secretKey, byte[] publicKey)
public static byte[] OpenDetached(DetachedBox detached, byte[] nonce, byte[] secretKey, byte[] publicKey)
```

Public key boxes encrypted with `CreateDetached` can be decrypted using `OpenDetached`. `OpenDetached()` takes a `cipherText` encrypted by `CreateDetached`, the recipients 32 byte `secretKey`, the senders 32 byte `publicKey`, a 24 byte `nonce`, and a 16 byte `mac`.

The `mac` and `cipherText` may be encapsulated by a `DetachedBox` object, or may be passed individually using one of the overloaded methods. If successful, a byte representation of the encrypted message will be returned, otherwise an exception will be thrown.

_This method internally uses `crypto_box_open_detached`._

## Algorithm Details

- Key exchange: Curve25519
- Encryption: XSalsa20 stream cipher
- Authentication: Poly1305 MAC